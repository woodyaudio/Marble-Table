<style>
    :root { 
        --panel-w: 340px; 
        --detail-w: 290px; 
        --main-blue: #0c3060; 
    }

    #map-container { display: flex; width: 100%; height: 100%; position: relative; overflow: hidden; }
    
    /* [PC] ë ˆì´ì•„ì›ƒ */
    #map-area { flex: 1; height: 100%; position: relative; order: 2; }
    #map { width: 100%; height: 100%; z-index: 1; }

    #left-panel { 
        width: var(--panel-w); 
        height: 100%; 
        background: rgba(235, 248, 255, 0.85); /* PC ìƒ‰ê°ê³¼ ë™ì¼í•˜ê²Œ ê³ ì • */
        backdrop-filter: blur(30px); 
        border-right: 1px solid rgba(255,255,255,0.5); 
        display: flex; 
        flex-direction: column; 
        order: 1; 
        z-index: 10; 
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* íƒ€ì´í‹€ ë””ìì¸ */
    .main-title-box { margin: 15px 16px 15px; padding: 12px 20px; border: 2px solid var(--main-blue); border-radius: 12px; background: rgba(255,255,255,0.5); }
    .main-title-box h1 { font-family: 'Nunito', sans-serif; font-size: 1.3em; color: var(--main-blue); display: flex; align-items: center; gap: 8px; }

    /* ëª¨ë°”ì¼ ì ‘ê¸°/í¼ì¹˜ê¸° ë²„íŠ¼ ë””ìì¸ */
    .drag-handle { display: none; } 

    /* [ëª¨ë°”ì¼] UI ëŒ€ì‘ */
    @media (max-width: 768px) {
        #map-area { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #left-panel { 
            position: fixed; 
            bottom: 45px; 
            left: 0; right: 0; 
            width: 100%; 
            height: 44dvh; /* 2.5ì¹¸ì´ ë³´ì´ë„ë¡ ì¡°ì • */
            border-radius: 24px 24px 0 0; 
            background: rgba(235, 248, 255, 0.95); /* ëª¨ë°”ì¼ë„ íˆ¬ëª… í•˜ëŠ˜ìƒ‰ ìœ ì§€ */
            border-right: none;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.08);
        }
        #left-panel.collapsed { transform: translateY(calc(100% - 45px)); }
        
        /* ì„¸ë²ˆì§¸ ì‚¬ì§„ ì°¸ê³ : ì ‘ê¸°/í¼ì¹˜ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .drag-handle { 
            display: flex; 
            justify-content: center; 
            padding: 10px 0; 
            cursor: pointer; 
        }
        .toggle-btn-text { 
            background: #e2e8f0; 
            padding: 4px 16px; 
            border-radius: 20px; 
            font-size: 11px; 
            font-weight: 800; 
            color: #64748b; 
        }
        .main-title-box { display: none; }
    }

    /* ì‹ë‹¹ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .restaurant-card {
        padding: 15px; 
        background: rgba(255, 255, 255, 0.7); 
        border-radius: 12px; 
        margin-bottom: 10px; 
        border: 1px solid #fff; 
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0,0,0,0.02);
    }
    .dinner-badge { background: #e0e7ff; color: #4338ca; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 800; margin-left: 6px; border: 1px solid #c7d2fe; }
</style>

<div id="map-container">
    <div id="map-area"><div id="map"></div></div>
    
    <div id="left-panel">
        <div class="drag-handle" onclick="toggleCollapse()">
            <div class="toggle-btn-text">ì ‘ê¸° / í¼ì¹˜ê¸°</div>
        </div>
        
        <div id="list-panel">
            <div class="main-title-box">
                <h1>ğŸ´ â­ Woody-Table</h1>
            </div>

            <div id="list-header" style="padding-bottom: 10px;">
                <input type="text" id="searchInput" 
                    style="width:calc(100% - 32px); margin: 0 16px 12px; padding:12px 15px; border-radius:12px; border:1px solid #eee; background:rgba(255,255,255,0.8);" 
                    placeholder="ì‹ë‹¹ ê²€ìƒ‰..." oninput="filterData()">
                
                <div class="filter-row" style="display: flex; gap: 6px; padding: 0 16px;">
                    <select id="priceFilter" onchange="filterData()" style="flex:1.5; padding:8px; border-radius:12px; border:1px solid #fff; background:rgba(255,255,255,0.6); font-size:0.75em;">
                        <option value="all">ê°€ê²© ì „ì²´</option>
                        <option value="7000">7,000ì›ëŒ€</option>
                        <option value="8000">8,000ì›ëŒ€</option>
                    </select>
                    <div id="dinnerToggle" onclick="toggleDinner()" style="flex:1.5; padding:8px; border-radius:12px; background:rgba(255,255,255,0.6); font-size:0.75em; text-align:center; cursor:pointer; display:flex; align-items:center; justify-content:center; border:1px solid #fff;">ğŸŒ™ ì„ì‹ ê°€ëŠ¥</div>
                    <div onclick="goHome()" style="flex:0.7; padding:8px; border-radius:12px; background:#fff; text-align:center; cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,0.1);">ğŸ </div>
                </div>
            </div>

            <div id="list-scroll" style="flex:1; overflow-y:auto; padding: 10px 16px;">
                <div id="restaurantCards"></div>
            </div>
        </div>
    </div>
</div>

<script>
(function() {
    let restaurantsData = [];
    const homeLoc = { lat: 37.479932, lng: 126.895215 };
    let map, markerLayer;

    async function init() {
        let retry = 0;
        while (typeof L === 'undefined' && retry < 20) {
            await new Promise(r => setTimeout(r, 100));
            retry++;
        }

        if (!map && document.getElementById('map')) {
            const isMobile = window.innerWidth <= 768;
            map = L.map('map', { zoomControl: false }).setView([isMobile ? homeLoc.lat - 0.0006 : homeLoc.lat, homeLoc.lng], 17);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            markerLayer = L.layerGroup().addTo(map);

            L.marker([homeLoc.lat, homeLoc.lng], { 
                icon: L.divIcon({ 
                    html: `<div style="display:flex; flex-direction:column; align-items:center;">
                            <div style="font-size:20px; background:#fff; border-radius:50%; width:36px; height:36px; display:flex; align-items:center; justify-content:center; border:3px solid #ffcf00; box-shadow:0 2px 8px rgba(0,0,0,0.2);">ğŸ¢</div>
                            <div style="margin-top:4px; font-size:11px; font-weight:700; color:#0c3060; text-shadow:-1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff; white-space:nowrap; color:#d97706;">ë„·ë§ˆë¸” ì»´í¼ë‹ˆ</div>
                           </div>`, 
                    className: '', iconSize: [100, 60] 
                }) 
            }).addTo(map);
        }

        try {
            const res = await fetch('data/restaurants.json');
            const data = await res.json();
            restaurantsData = data.filter(r => r.name !== 'Dev_Test'); // [ê°œì¸ì„¤ì •] Dev_Test í•„í„°ë§
            filterData();
            setTimeout(() => map.invalidateSize(), 300);
        } catch(e) { console.error(e); }
    }

    window.filterData = function() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        const p = document.getElementById('priceFilter').value;
        const isD = document.getElementById('dinnerToggle').classList.contains('active');
        
        const filtered = restaurantsData.filter(r => {
            const mQ = r.name.toLowerCase().includes(q);
            const mP = p === 'all' || (p === '7000' ? r.price < 8000 : r.price >= 8000);
            const mD = !isD || (r.hours.includes('ì„ì‹') || /17:|18:|19:/.test(r.hours));
            return mQ && mP && mD;
        });

        document.getElementById('restaurantCards').innerHTML = filtered.map(r => {
            const isDinner = r.hours.includes('ì„ì‹') || /17:|18:|19:/.test(r.hours);
            return `
            <div class="restaurant-card" onclick="selectRestaurant(${r.id})">
                <div style="font-weight:700; color:var(--main-blue);">${r.name}</div>
                <div style="font-size:0.85em; color:#64748b; margin-top:5px; display:flex; align-items:center;">
                    ğŸ’³ ${r.price.toLocaleString()}ì›
                    ${isDinner ? '<span class="dinner-badge">ğŸŒ™ ì„ì‹ ê°€ëŠ¥</span>' : ''}
                </div>
            </div>`;
        }).join('');

        if (markerLayer) {
            markerLayer.clearLayers();
            filtered.forEach(r => {
                L.marker([r.lat, r.lng], { 
                    icon: L.divIcon({ html: `<div style="display:flex; flex-direction:column; align-items:center;"><div style="width:30px; height:30px; background:#fff; border:2.5px solid #3b82f6; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:14px;">ğŸ´</div><div style="margin-top:4px; font-size:11px; font-weight:700; color:#0c3060; text-shadow:-1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff; white-space:nowrap;">${r.name}</div></div>`, className: '', iconSize: [100, 60] }) 
                }).addTo(markerLayer).on('click', () => selectRestaurant(r.id));
            });
        }
    }

    window.toggleCollapse = function() {
        document.getElementById('left-panel').classList.toggle('collapsed');
    }

    window.toggleDinner = function() {
        const b = document.getElementById('dinnerToggle');
        b.classList.toggle('active');
        b.style.background = b.classList.contains('active') ? '#0c3060' : 'rgba(255,255,255,0.6)';
        b.style.color = b.classList.contains('active') ? '#fff' : '#000';
        filterData();
    }

    window.goHome = function() {
        const isMobile = window.innerWidth <= 768;
        map.setView([isMobile ? homeLoc.lat - 0.0006 : homeLoc.lat, homeLoc.lng], 17);
    }

    window.selectRestaurant = function(id) {
        const r = restaurantsData.find(x => x.id === id);
        if (r && map) map.panTo([r.lat, r.lng]);
    }

    init();
})();
</script>